#include <XC.h>

#define SINE_OUT LATCbits.LATC0
#define LED_OUT LATAbits.LA1
#define TEST_OUT LATBbits.LATB3
#define RS485_TX_ENABLE LATCbits.LATC1

#define TEMP_AD_CHANNEL 8
#define RH_AD_CHANNEL 4

#define DEFAULT_DEVICE_ID 255

#define MINIMUM_MODBUS_LENGTH 8

#define MAX_PERIOD 60

#define MAXBUFFER 128
#define false 0
#define true !false
#define BOOL unsigned char

#define TRUE true
#define FALSE false
#define FOREVER 1

#define PWM_OUT LATCbits.LATC0 // $$$$ 

#define CR 13
#define LF 10
#define BACKSPACE 8
#define SPACE 32
#define ESCAPE 27
#define RIGHT_ARROW 67
#define LEFT_ARROW 68
#define UP_ARROW 65
#define DOWN_ARROW 66

#define VERSION_NUMBER 80

#define VERSION_NUMBER_ADDRESS 0
#define RH_INPUT_ADDRESS 4

#define TEMPERATURE_CELSIUS_INPUT_ADDRESS 8
#define TEMPERATURE_FAHRENHEIT_INPUT_ADDRESS 12
#define DEWPOINT_INPUT_ADDRESS 16

#define MAX_RH_SAMPLES 20
#define MAX_TEMP_SAMPLES 8
#define DEFAULT_RH_FILTERSIZE 32 
#define DEFAULT_PERIOD  20
#define NUMBER_OF_DEFAULT_SETPOINTS 6

#define MAX_RH_SETPOINTS 64
#define TEMP_CELSIUS_TABLE_SIZE 50
#define MAX_PERIOD 60
#define MAX_FILTERSIZE 255

#define SLAVE_ID_EEPROM_ADDRESS 0
#define NUMBER_OF_SETPOINTS_EEPROM_ADDRESS 2
#define FILTER_SIZE_EEPROM_ADDRESS 4
#define PULSE_PERIOD_EEPROM_ADDRESS 6
#define REFERENCE_OFFSET_TEMPERATURE_ADDRESS 8
#define REFERENCE_GAIN_TEMPERATURE_ADDRESS 10
#define MEASURED_OFFSET_TEMPERATURE_ADDRESS 482
#define MEASURED_GAIN_TEMPERATURE_ADDRESS 484

#define CALIBRATE_TEMP_OFFSET_FUNC_CODE 125
#define CALIBRATE_TEMP_GAIN_FUNC_CODE 126
#define GET_SLAVE_ID_FUNC_CODE 127
#define SET_SLAVE_ID_FUNC_CODE 128

#define CAL_START_EEPROM_ADDRESS 12
#define EEPROM_FLAG_ADDRESS 480
#define MAX_EEPROM_REGISTER 511

#define MODBUS_TIMEOUT_MILLISECONDS 2 // 6
#define MAX_MODBUS_SIZE 256

#define LSB_INDEX 0
#define MSB_INDEX 1

// #define START_AD_COUNT_REGISTER 1000

#define ERROR_ILLEGAL_FUNCTION 1
#define ERROR_ILLEGAL_DATA_ADDRESS 2
#define ERROR_ILLEGAL_DATA_VALUE 3
#define ERROR_SERVICE_DEVICE_FAILURE 4
#define ERROR_ACKNOWLEDGE 5
#define ERROR_SERVICE_DEVICE_BUSY 6
#define ERROR_MEMORY_PARITY 8


typedef union 
{
	unsigned char b[2];
	unsigned short integer;
} ConvertType;

typedef struct
{
    unsigned short ADcounts;
    unsigned short RHpercent;
} TableType;

enum {
    AD_STANDBY = 0,    
    AD_MEASURE_RH,
    AD_RH_DATA_READY,
    AD_MEASURE_TEMPERATURE,
    AD_TEMP_DATA_READY
};

#define TRIGGER LATCbits.LATC3
